# =============================================================================
# Training Configuration for 60-65% Win Rate Blueprint
# =============================================================================

# Lambda Labs GPU Training Configuration
lambda_labs:
  gpu_type: "8xA100_80GB"
  estimated_hours: 20
  estimated_cost_usd: 206

  # Training schedule
  initial_training:
    duration_hours: 20
    parallel_jobs: 4  # LSTM (3) + Transformer (1)

  monthly_retrain:
    provider: "vast.ai"
    gpu_type: "1xA100"
    duration_hours: 3
    estimated_cost_usd: 45

# Neural Network Hyperparameters
neural_networks:
  lstm:
    # One model per pair (EUR/USD, GBP/USD, XAU/USD)
    models: 3
    architecture:
      layer_1_units: 64
      layer_2_units: 32
      dropout: 0.2
      output_activation: "sigmoid"

    training:
      epochs: 100
      batch_size: 32
      learning_rate: 0.001
      optimizer: "adam"
      loss: "binary_crossentropy"
      early_stopping_patience: 15
      validation_split: 0.2

    input:
      sequence_length: 60  # 60 candles lookback
      features: 50  # All features

    output:
      prediction_horizon: 1  # Next candle direction (0=down, 1=up)

  transformer:
    # Single model for trend alignment scoring
    models: 1
    architecture:
      d_model: 128
      num_heads: 4
      num_layers: 3
      d_ff: 512
      dropout: 0.1
      output_activation: "linear"

    training:
      epochs: 80
      batch_size: 64
      learning_rate: 0.0001
      optimizer: "adam"
      loss: "mse"
      early_stopping_patience: 12
      validation_split: 0.2

    input:
      sequence_length: 100  # Longer context for trend
      features: 50

    output:
      trend_score_range: [-1, 1]  # -1=strong down, +1=strong up

# Reinforcement Learning Agent Configuration
rl_agents:
  algorithm: "PPO"
  total_agents: 15

  # Agent categories
  categories:
    conservative:
      count: 5
      risk_tolerance: "low"
      target_win_rate: "65-70%"
      max_drawdown: 0.10

    balanced:
      count: 5
      risk_tolerance: "medium"
      target_win_rate: "60-65%"
      max_drawdown: 0.15

    specialists:
      count: 5
      specialization:
        - "trending_markets"
        - "ranging_markets"
        - "high_volatility"
        - "low_volatility"
        - "news_events"
      target_win_rate: "60-70%"
      max_drawdown: 0.20

  # PPO Hyperparameters
  ppo_config:
    learning_rate: 0.0003
    n_steps: 2048
    batch_size: 64
    n_epochs: 10
    gamma: 0.99
    gae_lambda: 0.95
    clip_range: 0.2
    ent_coef: 0.01
    vf_coef: 0.5
    max_grad_norm: 0.5

  # Training configuration
  training:
    total_timesteps: 8_000_000  # 8M steps per agent
    parallel_environments: 8
    save_frequency: 100_000
    eval_frequency: 50_000
    eval_episodes: 100

  # Environment configuration
  environment:
    name: "ForexTradingEnv"
    observation_space: 50  # 50 features
    action_space: 3  # [0=hold, 1=buy, 2=sell]
    reward_function: "risk_adjusted_return"
    max_episode_steps: 1000

  # Ensemble selection
  ensemble:
    select_top_n: 5  # Use top 5 agents in production
    selection_criteria: "sharpe_ratio"
    min_confidence: 0.65
    revalidate_every_months: 1

# GAN Synthetic Data Configuration
gan:
  enabled: true
  architecture: "TimeGAN"

  generator:
    hidden_dim: 64
    num_layers: 3

  discriminator:
    hidden_dim: 64
    num_layers: 3

  training:
    epochs: 500
    batch_size: 128
    learning_rate: 0.001

  generation:
    max_synthetic_ratio: 0.20  # Max 20% of training data
    target_years: 20  # Generate up to 20 years
    validation_required: true

  validation:
    tests:
      - "kolmogorov_smirnov"
      - "autocorrelation"
      - "distribution_match"
    min_pass_threshold: 0.85

# Walk-Forward Validation Configuration
validation:
  walk_forward:
    total_windows: 12
    train_months: 9
    test_months: 3

    # Strict criteria - ALL windows must pass
    pass_criteria:
      min_test_win_rate: 0.58
      max_test_win_rate: 0.65
      max_train_test_gap: 0.07
      min_sharpe_ratio: 1.5
      max_drawdown: 0.20
      min_profit_factor: 1.8
      min_trades_per_window: 30

  monte_carlo:
    iterations: 10_000
    permutation_method: "bootstrap"
    confidence_level: 0.95

    risk_metrics:
      - "max_drawdown"
      - "sharpe_ratio"
      - "sortino_ratio"
      - "win_rate"
      - "profit_factor"

  transaction_costs:
    # Realistic spreads in pips
    EUR_USD: 3
    GBP_USD: 4
    XAU_USD: 7

    slippage_pips: 1
    commission_per_lot: 0  # Spread-only brokers

# Model Checkpointing & Versioning
checkpointing:
  save_frequency: "every_epoch"
  keep_best_n: 3
  metric: "val_loss"

  versioning:
    format: "YYYYMMDD_HHMMSS_model_name"
    storage: "local"  # Will be 's3' in production
    backup_frequency: "daily"

# Monitoring & Logging
monitoring:
  tensorboard:
    enabled: true
    log_dir: "./logs/tensorboard"
    update_frequency: 100

  metrics_to_track:
    - "loss"
    - "accuracy"
    - "sharpe_ratio"
    - "win_rate"
    - "profit_factor"
    - "max_drawdown"
    - "avg_trade_duration"
    - "confidence_calibration"

# Reproducibility
reproducibility:
  random_seed: 42
  deterministic: true

# Hardware Requirements
hardware:
  recommended:
    cpu_cores: 16
    ram_gb: 64
    gpu_vram_gb: 80
    storage_gb: 500
